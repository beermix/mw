From 302abfad0163b0d420b55f092c1237dbe31b5231 Mon Sep 17 00:00:00 2001
From: Andrii-hotfix <dehtyaryov.ipt@gmail.com>
Date: Thu, 9 Aug 2018 19:03:27 +0300
Subject: [PATCH 1/2] PCP - System performance analysis toolkit - New Package

---
 mingw-w64-pcp/PKGBUILD                     | 45 ++++++++++++++++++++++
 mingw-w64-pcp/mingw-w64-x86_64-pcp.install | 27 +++++++++++++
 2 files changed, 72 insertions(+)
 create mode 100644 mingw-w64-pcp/PKGBUILD
 create mode 100644 mingw-w64-pcp/mingw-w64-x86_64-pcp.install

diff --git a/mingw-w64-pcp/PKGBUILD b/mingw-w64-pcp/PKGBUILD
new file mode 100644
index 0000000000..1982eb2594
--- /dev/null
+++ b/mingw-w64-pcp/PKGBUILD
@@ -0,0 +1,45 @@
+# maintainer: PCP development team <pcp@groups.io>
+
+_realname=pcp
+pkgbase=mingw-w64-${_realname}
+pkgname="${MINGW_PACKAGE_PREFIX}-${_realname}"
+pkgver=4.1.1
+pkgrel=1
+pkgdesc='Performance Co-Pilot (mingw-w64)'
+arch=('any')
+url='https://pcp.io/'
+source=(
+  "${_realname}-${pkgver}.src.tar.gz::https://bintray.com/pcp/source/download_file?file_path=${_realname}-${pkgver}.src.tar.gz"
+)
+# will be extracted in prepare()
+noextract=("${_realname}-${pkgver}.src.tar.gz")
+sha256sums=('430c3ce05db5e475dc0d962ac584a61a91c69b791e66d5cc684a7aada3e21f52')
+makedepends=('pkg-config>0.9.0')
+depends=('mingw-w64-x86_64-qbs')
+install=$pkgname.install
+
+prepare() {
+  # ignore symlinks errors
+  tar -xf ${_realname}-${pkgver}.src.tar.gz 2> /dev/null || true
+}
+
+build() {
+    cd ${srcdir}/${_realname}-${pkgver}
+    export QMAKE=/mingw64/bin/qmake.exe
+    ./configure  \
+      --prefix=${MINGW_PREFIX}\
+      --build=${MINGW_CHOST}  \
+      --host=${MINGW_CHOST}   \
+      --target=${MINGW_CHOST} \
+      --without-perl          \
+      --with-qt
+
+    make
+}
+
+package() {
+  cd ${srcdir}/${_realname}-${pkgver}
+  export DIST_ROOT="${pkgdir}"
+  make install
+  echo "done"
+}
diff --git a/mingw-w64-pcp/mingw-w64-x86_64-pcp.install b/mingw-w64-pcp/mingw-w64-x86_64-pcp.install
new file mode 100644
index 0000000000..1c74000ea3
--- /dev/null
+++ b/mingw-w64-pcp/mingw-w64-x86_64-pcp.install
@@ -0,0 +1,27 @@
+post_install() {
+	mkdir /var/tmp
+	BASE=/mingw64
+  prefix=`echo $EXEPATH | sed -e 's@\\\\@/@g'`
+  for file in /etc/pcp.conf /etc/pcp/pmcd/pmcd.conf
+  do
+     echo "Fixing $file ..."
+     sed <$BASE$file >$tmp.conf \
+	   -e "s@\([= 	]\)$BASE/@\1$prefix$BASE/@" \
+     # end
+     cp $tmp.conf $BASE$file
+  done
+}
+
+post_upgrade() {
+	mkdir /var/tmp
+  BASE=/mingw64
+  prefix=`echo $EXEPATH | sed -e 's@\\\\@/@g'`
+  for file in /etc/pcp.conf /etc/pcp/pmcd/pmcd.conf
+  do
+     echo "Fixing $file ..."
+     sed <$BASE$file >$tmp.conf \
+     -e "s@\([= 	]\)$BASE/@\1$prefix$BASE/@" \
+     # end
+     cp $tmp.conf $BASE$file
+  done
+}

From 8e981c94999e474bb34c40e3b3627543aedc4f00 Mon Sep 17 00:00:00 2001
From: Andrii-hotfix <dehtyaryov.ipt@gmail.com>
Date: Fri, 24 Aug 2018 17:54:10 +0300
Subject: [PATCH 2/2] license added + some extract updates

---
 mingw-w64-pcp/PKGBUILD | 8 +-------
 1 file changed, 1 insertion(+), 7 deletions(-)

diff --git a/mingw-w64-pcp/PKGBUILD b/mingw-w64-pcp/PKGBUILD
index 1982eb2594..e3c19ee0b4 100644
--- a/mingw-w64-pcp/PKGBUILD
+++ b/mingw-w64-pcp/PKGBUILD
@@ -11,18 +11,12 @@ url='https://pcp.io/'
 source=(
   "${_realname}-${pkgver}.src.tar.gz::https://bintray.com/pcp/source/download_file?file_path=${_realname}-${pkgver}.src.tar.gz"
 )
-# will be extracted in prepare()
-noextract=("${_realname}-${pkgver}.src.tar.gz")
+license=('GPL2')
 sha256sums=('430c3ce05db5e475dc0d962ac584a61a91c69b791e66d5cc684a7aada3e21f52')
 makedepends=('pkg-config>0.9.0')
 depends=('mingw-w64-x86_64-qbs')
 install=$pkgname.install
 
-prepare() {
-  # ignore symlinks errors
-  tar -xf ${_realname}-${pkgver}.src.tar.gz 2> /dev/null || true
-}
-
 build() {
     cd ${srcdir}/${_realname}-${pkgver}
     export QMAKE=/mingw64/bin/qmake.exe
