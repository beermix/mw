# Maintainer: Felix Yan <felixonmars@archlinux.org>
# Maintainer: Morten Linderud <foxboron@archlinux.org>
# https://github.com/rclone/rclone/releases

_realname=rclone
pkgbase=mingw-w64-${_realname}
pkgname="${MINGW_PACKAGE_PREFIX}-${_realname}"
pkgver=1.52.2
pkgrel=1
arch=('any')
source=("$pkgname-$pkgver.tar.gz::https://github.com/rclone/rclone/archive/v$pkgver.tar.gz")
sha512sums=('f49f0dcf8bfa105b01b35921daa655a6c1161f6505e2299f027a4059d196adcc673038b1718320e6f0b8bb053fad8d2de7714f66fa245dd90ea0a791e848a418')

build() {
  cd "rclone-$pkgver"

  export GOFLAGS="-buildmode=pie -trimpath"
  export CGO_LDFLAGS="${LDFLAGS}"
  export CGO_CFLAGS="${CFLAGS}"
  export CGO_CPPFLAGS="${CPPFLAGS}"

  PATH=".:$PATH" make TAG=v$pkgver rclone
# ./rclone genautocomplete bash rclone.bash_completion
# ./rclone genautocomplete zsh rclone.zsh_completion
}

check() {
  cd "rclone-$pkgver"
  make TAG=v$pkgver test
}

package() {
  cd "rclone-$pkgver"

  install -Dm755 rclone "$pkgdir"/usr/bin/rclone

#  install -Dm644 rclone.bash_completion "$pkgdir"/usr/share/bash-completion/completions/rclone
#  install -Dm644 rclone.zsh_completion "$pkgdir"/usr/share/zsh/site-functions/_rclone
}
